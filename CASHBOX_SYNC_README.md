# نظام مزامنة الصناديق النقدية مع دليل الحسابات

## نظرة عامة

تم إنشاء نظام آلي لمزامنة الصناديق النقدية المسجلة في صفحة "الصناديق النقدية" مع دليل الحسابات المحاسبي. هذا النظام يضمن أن كل صندوق نقدي له حساب مقابل في دليل الحسابات.

## الميزات

### 1. إنشاء الحساب الرئيسي تلقائياً
- يتم إنشاء حساب رئيسي بعنوان "الصناديق النقدية" (المستوى 1)
- الكود يتم إنشاؤه تلقائياً (5000، 6000، 7000... حسب الحسابات الموجودة)
- التصنيف: "الصناديق النقدية"
- النوع: "مدينة"

### 2. إنشاء حسابات فرعية للصناديق
- كل صندوق نقدي يحصل على حساب فرعي تحت الحساب الرئيسي (المستوى 2)
- اسم الحساب: "صندوق [اسم الصندوق]"
- الكود يتم إنشاؤه تلقائياً (مثال: 50001، 50002، إلخ)
- مركز التكلفة: اسم الفرع المرتبط بالصندوق

### 3. المزامنة التلقائية
- عند إضافة صندوق جديد: يتم إنشاء حساب تلقائياً
- عند حذف صندوق: يتم حذف الحساب المقابل
- عند تحديث بيانات الصندوق: يتم تحديث الحساب المقابل

## طرق المزامنة

### 1. من صفحة الصناديق النقدية
- زر "مزامنة مع الحسابات": يقوم بمزامنة جميع الصناديق الموجودة
- المزامنة التلقائية عند إضافة/حذف صندوق

### 2. من صفحة دليل الحسابات
- زر "مزامنة الصناديق": متاح في الهيدر الرئيسي للصفحة
- يقوم بمزامنة جميع الصناديق مع إعادة تحميل شجرة الحسابات

### 3. برمجياً
```typescript
import { syncCashBoxesToAccounts } from '@/scripts/syncCashBoxesToAccounts';

// مزامنة جميع الصناديق
const result = await syncCashBoxesToAccounts();
console.log(`تم إنشاء ${result.created} حساب جديد`);
console.log(`تم تحديث ${result.updated} حساب موجود`);
```

## الملفات المضافة/المعدلة

### ملفات جديدة:
- `src/scripts/syncCashBoxesToAccounts.ts`: السكريپت الرئيسي للمزامنة
- `scripts/sync-cashboxes.js`: سكريپت مساعد للتشغيل اليدوي

### ملفات معدلة:
- `src/pages/management/CashBoxesPage.tsx`: إضافة زر المزامنة ووظائف تلقائية
- `src/pages/accounting/ChartOfAccountsPage.tsx`: إضافة زر مزامنة الصناديق

## استخدام النظام

### 1. إضافة صندوق جديد
1. اذهب إلى صفحة "الصناديق النقدية"
2. اضغط "إضافة صندوق"
3. املأ البيانات المطلوبة
4. سيتم إنشاء الحساب المحاسبي تلقائياً

### 2. مزامنة الصناديق الموجودة
1. من صفحة "الصناديق النقدية" اضغط "مزامنة مع الحسابات"
2. أو من صفحة "دليل الحسابات" اضغط "مزامنة الصناديق"

### 3. التحقق من النتائج
- اذهب إلى صفحة "دليل الحسابات"
- ابحث عن حساب "الصناديق النقدية"
- ستجد الحسابات الفرعية لجميع الصناديق

## معالجة الأخطاء

- إذا فشلت المزامنة: ستظهر رسالة خطأ واضحة
- إذا تم إنشاء الصندوق ولكن فشلت المزامنة: ستظهر رسالة تنبيه
- يمكن إعادة تشغيل المزامنة في أي وقت بدون مشاكل

## ملاحظات مهمة

1. **الأمان**: النظام يتحقق من وجود الحسابات قبل إنشائها لتجنب التكرار
2. **المرونة**: يمكن تشغيل المزامنة عدة مرات بدون مشاكل
3. **الترقيم**: أكواد الحسابات تتبع نظام ترقيم منطقي ومرتب
4. **الاستقلالية**: النظام يعمل بشكل مستقل عن البيانات الموجودة

## الدعم

إذا واجهت أي مشاكل:
1. تحقق من console للحصول على رسائل الخطأ التفصيلية
2. تأكد من صحة اتصال قاعدة البيانات
3. يمكن إعادة تشغيل المزامنة بأمان
